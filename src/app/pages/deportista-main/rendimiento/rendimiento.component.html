<div
  class="min-h-screen bg-gradient-to-br from-gray-950 to-gray-900 text-gray-100"
  *ngIf="!loading"
>
  <!-- Header premium -->
  <nav
    class="bg-gray-900/90 backdrop-blur-lg border-b border-gray-700 fixed w-full z-10"
  >
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16 items-center">
        <div class="flex items-center space-x-2">
          <span class="text-xl font-bold text-blue-400 tracking-tight"
            >AllSports</span
          >
          <span
            class="text-xs bg-blue-900/30 text-blue-300 px-2 py-1 rounded-full mt-1"
            >Deportista</span
          >
        </div>

        <!-- Menú central mejorado -->
        <div class="hidden md:block">
          <div class="ml-4 flex items-center space-x-6">
            <a
              *ngFor="let nav of navigation"
              [routerLink]="nav.route"
              class="group flex items-center px-3 py-2 rounded-lg transition-all duration-300"
              [ngClass]="{
                'bg-blue-900/20 text-blue-400': router.isActive(
                  nav.route,
                  false
                ),
                'text-gray-400 hover:bg-gray-800/30 hover:text-blue-300':
                  !router.isActive(nav.route, false)
              }"
            >
              <mat-icon class="mr-2 group-hover:scale-110 transition-transform">{{nav.icon}}</mat-icon>
              <span class="text-sm font-medium">{{ nav.name }}</span>
            </a>
          </div>
        </div>

        <!-- Perfil con efecto neumórfico -->
        <div class="flex items-center space-x-4">
          <div class="relative">
            <button
              (click)="toggleUserDropdown()"
              class="flex items-center space-x-2 group focus:outline-none"
            >
              <div class="relative">
                <img
                  class="h-9 w-9 rounded-full border-2 border-blue-400/30 shadow-lg group-hover:border-blue-400 transition-all duration-300"
                  [src]="fotoPerfil"
                  alt="Foto perfil"
                />
                <div
                  class="absolute -right-1 -bottom-1 bg-green-400 w-3 h-3 rounded-full border-2 border-gray-900"
                ></div>
              </div>
              <div class="text-left hidden lg:block">
                <p class="text-sm font-medium text-gray-100">
                  {{ nombre }} {{ apellido }}
                </p>
                <p class="text-xs text-gray-400 font-light">Deportista</p>
              </div>
              <mat-icon
                class="text-gray-400 group-hover:text-blue-400 transition-all duration-300"
              >
                {{ showUserDropdown ? "expand_less" : "expand_more" }}
              </mat-icon>
            </button>
            <div
              *ngIf="showUserDropdown"
              class="origin-top-right absolute right-0 mt-2 w-48 rounded-xl shadow-lg py-2 bg-gray-800 border border-gray-700 z-20"
            >
              <a
                routerLink="../perfil"
                class="flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-gray-700/50"
              >
                <mat-icon class="mr-2">person</mat-icon> Perfil
              </a>
              <a
                (click)="cerrarSesion()"
                class="flex items-center px-4 py-2 text-sm text-gray-300 hover:bg-gray-700/50 cursor-pointer"
              >
                <mat-icon class="mr-2">logout</mat-icon> Cerrar sesión
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Contenido principal -->
  <div class="pt-24 pb-12 max-w-6xl mx-auto px-4">
    <!-- Encabezado premium -->
    <div class="text-center mb-10">
      <div class="inline-flex items-center justify-center mb-6">
        <div
          class="h-1 w-24 bg-gradient-to-r from-sky-500 to-cyan-500 rounded-full"
        ></div>
        <div class="mx-4 text-sky-400 font-medium tracking-wider">
          ANÁLISIS DE RENDIMIENTO
        </div>
        <div
          class="h-1 w-24 bg-gradient-to-r from-cyan-500 to-sky-500 rounded-full"
        ></div>
      </div>

      <h1
        class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 via-cyan-400 to-sky-500 tracking-tight mb-3"
      >
        Mi Rendimiento
      </h1>
      <p class="text-lg text-gray-400 max-w-2xl mx-auto">
        Seguimiento detallado de tus métricas deportivas
      </p>
    </div>

    <!-- Sección superior: Perfil y objetivos -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
      <!-- Tarjeta de perfil mejorada -->
      <div
        class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-xl border border-gray-700 overflow-hidden transition-all hover:shadow-sky-500/10"
      >
        <div class="p-6">
          <div class="flex items-center space-x-4">
            <div class="relative">
              <div
  class="relative h-20 w-20 rounded-full bg-gradient-to-r from-sky-500 to-cyan-400 p-0.5"
>
  <div
    class="h-full w-full rounded-full bg-gray-800 border-2 border-gray-900 flex items-center justify-center overflow-hidden"
  >
    <img
      class="h-full w-full object-cover rounded-full border-2 border-blue-400/30 shadow-lg group-hover:border-blue-400 transition-all duration-300"
      [src]="fotoPerfil"
      alt="Foto perfil"
    />
  </div>
</div>

              <span
                class="absolute bottom-0 right-0 w-4 h-4 bg-emerald-400 rounded-full border-2 border-gray-900"
              ></span>
            </div>
            <div>
              <h2 class="text-xl font-bold text-gray-100">{{nombre}} {{apellido}}</h2>
              <p class="text-sky-300 text-sm flex items-center">
                <mat-icon class="text-sm mr-1">sports_soccer</mat-icon>
               {{posicion}}
              </p>
            </div>
          </div>

          <div class="mt-6 grid grid-cols-3 gap-4 text-center">
            <div
              class="bg-gradient-to-br from-sky-900/30 to-gray-900/50 rounded-lg p-3 border border-sky-800/30"
            >
              <p class="text-2xl font-bold text-gray-100">
                {{ultimaMedicion?.peso}}<span class="text-sm text-gray-400 ml-1">kg</span>
              </p>
              <p class="text-xs text-gray-400 mt-1">Peso</p>
            </div>
            <div
              class="bg-gradient-to-br from-emerald-900/30 to-gray-900/50 rounded-lg p-3 border border-emerald-800/30"
            >
              <p class="text-2xl font-bold text-gray-100">
                {{ultimaMedicion?.estatura}}<span class="text-sm text-gray-400 ml-1">cm</span>
              </p>
              <p class="text-xs text-gray-400 mt-1">Estatura</p>
            </div>
            <div
              class="bg-gradient-to-br from-purple-900/30 to-gray-900/50 rounded-lg p-3 border border-purple-800/30"
            >
              <p class="text-2xl font-bold text-gray-100">{{ultimaMedicion?.imc}}</p>
              <p class="text-xs text-gray-400 mt-1">IMC</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Resumen de objetivos mejorado -->
      <div
        class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-xl border border-gray-700 p-6 col-span-2"
      >
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold flex items-center text-sky-400">
            <mat-icon class="mr-2 text-sky-400">flag</mat-icon>
            Mis Objetivos
          </h3>
          <span
            class="text-xs px-2 py-1 rounded-full bg-emerald-900/30 text-emerald-400 flex items-center"
          >
            <span
              class="w-2 h-2 bg-emerald-400 rounded-full mr-2 animate-pulse"
            ></span>
            Activo
          </span>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div
            *ngFor="let goal of objetivos.slice(0, 2)"
            class="bg-gradient-to-br from-gray-900/50 to-gray-800/30 rounded-xl p-4 border-l-4 border-sky-500"
          >
            <div class="flex justify-between items-start">
              <h4 class="font-medium text-gray-100">
                {{ goal.nombreObjetivo }}
              </h4>
              <span
                class="text-xs px-2 py-1 rounded-full"
                [class.bg-emerald-500]="goal.completado"
                [class.text-emerald-400]="goal.completado"
                [class.bg-sky-500]="!goal.completado"
                [class.text-sky-400]="!goal.completado"
              >
                {{ goal.completado ? "Completado" : "En progreso" }}
              </span>
            </div>
            <div class="mt-3">
              <div class="w-full bg-gray-700 rounded-full h-2">
                <div
                  class="h-2 rounded-full"
                  [class.bg-emerald-500]="goal.completado"
                  [class.bg-sky-500]="!goal.completado"
                  [style.width]="goal.completado"
                ></div>
              </div>
            </div>
            <div class="mt-3 flex justify-between text-xs text-gray-400">
              <span
                >{{ goal.valorActual }}/{{ goal.valorObjetivo }}
                {{ goal.unidad }}</span
              >
              <span>{{ goal.fechaObjetivo | date : "dd/MM/yyyy" }}</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Navegación por pestañas premium -->
    <nav
      class="flex space-x-1 bg-gradient-to-br from-gray-900/50 to-gray-800/50 rounded-xl p-1 mb-8 border border-gray-700"
    >
      <button
        [class]="
          currentView === 'metrics'
            ? 'bg-gradient-to-r from-sky-900/30 to-cyan-900/20 shadow-md text-sky-400'
            : 'text-gray-400 hover:bg-gray-700/50'
        "
        class="flex-1 py-3 px-4 rounded-lg font-medium text-sm flex items-center justify-center transition-all"
        (click)="this.cambiarVista('metrics')"
      >
        <mat-icon class="mr-2">analytics</mat-icon>
        Métricas
      </button>
      <button
        [class]="
          currentView === 'records'
            ? 'bg-gradient-to-r from-sky-900/30 to-cyan-900/20 shadow-md text-sky-400'
            : 'text-gray-400 hover:bg-gray-700/50'
        "
        class="flex-1 py-3 px-4 rounded-lg font-medium text-sm flex items-center justify-center transition-all"
        (click)="this.cambiarVista('records')"
      >
        <mat-icon class="mr-2">history</mat-icon>
        Registros
      </button>
      <button
        [class]="
          currentView === 'goals'
            ? 'bg-gradient-to-r from-sky-900/30 to-cyan-900/20 shadow-md text-sky-400'
            : 'text-gray-400 hover:bg-gray-700/50'
        "
        class="flex-1 py-3 px-4 rounded-lg font-medium text-sm flex items-center justify-center transition-all"
        (click)="this.cambiarVista('goals')"
      >
        <mat-icon class="mr-2">flag</mat-icon>
        Objetivos
      </button>
      <button
        [class]="
          currentView === 'stats'
            ? 'bg-gradient-to-r from-sky-900/30 to-cyan-900/20 shadow-md text-sky-400'
            : 'text-gray-400 hover:bg-gray-700/50'
        "
        class="flex-1 py-3 px-4 rounded-lg font-medium text-sm flex items-center justify-center transition-all"
        (click)="this.cambiarVista('stats')"
      >
        <mat-icon class="mr-2">flag</mat-icon>
        Stats
      </button>
      <button
        [class]="
          currentView === 'medicion'
            ? 'bg-gradient-to-r from-sky-900/30 to-cyan-900/20 shadow-md text-sky-400'
            : 'text-gray-400 hover:bg-gray-700/50'
        "
        class="flex-1 py-3 px-4 rounded-lg font-medium text-sm flex items-center justify-center transition-all"
        (click)="this.cambiarVista('medicion')"
      >
        <mat-icon class="mr-2">flag</mat-icon>
        Medicion Fisica
      </button>
    </nav>

    <!-- Sección de contenido dinámico -->
    <section class="mb-10">
      <!-- Vista de Métricas -->
      <div *ngIf="currentView === 'metrics'" class="space-y-6">
        <div class="flex justify-between items-center">
          <h3 class="text-xl font-bold flex items-center text-sky-400">
            <mat-icon class="mr-2 text-sky-400">insights</mat-icon>
            Métricas de Rendimiento
          </h3>
          <button
            (click)="mostrarFormMetrica()"
            class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-sky-600 to-sky-500 rounded-lg text-sm font-medium transition-all shadow-md hover:shadow-sky-500/20"
          >
            <mat-icon class="mr-2 text-sm">add</mat-icon>
            Nueva Métrica
          </button>
        </div>

        <!-- Formulario de métrica mejorado -->
        <div
          *ngIf="showmetricaForm"
          class="bg-gradient-to-br from-gray-900/50 to-gray-800/50 rounded-2xl shadow-lg p-6 border border-gray-700"
        >
          <form
            [formGroup]="metricForm"
            (ngSubmit)="addMetric()"
            class="space-y-4"
          >
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2"
                  >Nombre de la métrica</label
                >
                <input
                  type="text"
                  formControlName="nombre"
                  placeholder="Ej: Velocidad 40m"
                  class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
                />
              </div>
                          <div *ngIf="metricForm.get('nombre')?.errors">
  <small class="text-red-500">Campo Obligatorio.</small>
</div>
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2"
                  >Unidad de medida</label
                >
                <input
                  type="text"
                  formControlName="unidad"
                  placeholder="Ej: seg, cm, kg"
                  class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
                />
              </div>
                                        <div *ngIf="metricForm.get('unidad')?.errors">
  <small class="text-red-500">Campo Obligatorio.</small>
</div>
            </div>

            <div class="flex items-center">
              <label class="inline-flex items-center">
                <input
                  type="checkbox"
                  formControlName="esObjetivo"
                  class="rounded bg-gray-800/50 border-gray-700 text-sky-600 focus:ring-sky-500"
                />
                <span class="ml-2 text-sm text-gray-300"
                  >Puede ser objetivo de rendimiento</span
                >
              </label>
            </div>

            <div class="flex justify-end space-x-3 pt-4">
              <button
                type="button"
                (click)="cancelar()"
                class="px-4 py-2.5 border border-gray-700 rounded-lg text-sm font-medium text-gray-300 hover:bg-gray-700/50 transition-colors"
              >
                Cancelar
              </button>
              <button
                type="submit"
                [disabled]="metricForm.invalid"
                class="px-4 py-2.5 bg-gradient-to-r from-sky-600 to-sky-500 rounded-lg text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md hover:shadow-sky-500/20"
              >
                <mat-icon class="mr-2 text-sm">save</mat-icon>
                Guardar Métrica
              </button>
            </div>
          </form>
        </div>

        <!-- Listado de métricas mejorado -->
        <div
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"
        >
          <div
            *ngFor="let metric of metrics"
            class="bg-gradient-to-br from-gray-900/50 to-gray-800/50 rounded-2xl shadow-lg overflow-hidden transition-all border border-gray-700 hover:border-sky-500/30 hover:shadow-sky-500/10 hover:-translate-y-1"
          >
            <div class="p-5">
              <div class="flex justify-between items-start">
                <div>
                  <h4 class="font-bold text-lg text-gray-100">
                    {{ metric.nombre }}
                  </h4>
                  <span
                    class="text-xs font-mono px-2 py-1 mt-1 inline-block rounded-full bg-sky-500/10 text-sky-400"
                  >
                    {{ metric.unidad }}
                  </span>
                </div>
                <div class="flex space-x-2">
                  <span
                    *ngIf="metric.esObjetivo"
                    class="text-xs px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-400 flex items-center"
                  >
                    <mat-icon class="text-sm mr-1">flag</mat-icon>
                    Objetivo
                  </span>
                  <button
                    (click)="deleteItem('metric', metric.id)"
                    class="p-1 rounded-lg text-gray-400 hover:text-red-400 hover:bg-gray-700/50 transition-colors"
                  >
                    <mat-icon class="text-sm">delete</mat-icon>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Vista de Registros -->
    <section class="mb-10">
      <div *ngIf="currentView === 'records'" class="space-y-6">
        <div class="flex justify-between items-center">
          <h3 class="text-xl font-bold flex items-center text-sky-400">
            <mat-icon class="mr-2 text-sky-400">history</mat-icon>
            Registros de Rendimiento
          </h3>
          <button
            (click)="mostrarFormRendimiento()"
            class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-sky-600 to-sky-500 rounded-lg text-sm font-medium transition-all shadow-md hover:shadow-sky-500/20"
          >
            <mat-icon class="mr-2 text-sm">add</mat-icon>
            Nuevo Registro
          </button>
        </div>

        <!-- Filtros premium -->
        <div
          class="bg-gradient-to-br from-gray-900/50 to-gray-800/50 rounded-2xl shadow-lg p-6 border border-gray-700"
        >
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <div>
              <label
                class="block text-sm font-medium text-gray-300 mb-2 flex items-center"
              >
                <mat-icon class="mr-2 text-sm text-sky-400"
                  >filter_alt</mat-icon
                >
                Filtrar por métrica
              </label>
              <select
                [(ngModel)]="selectedMetric"
                (change)="filterRecords()"
                class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
              >
                <option [value]="''">Todas las métricas</option>
                <option *ngFor="let metric of metrics" [value]="metric.nombre">
                  {{ metric.nombre }}
                </option>
              </select>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-300 mb-2 flex items-center"
              >
                <mat-icon class="mr-2 text-sm text-emerald-400"
                  >calendar_today</mat-icon
                >
                Rango de fechas
              </label>
              <div class="flex items-center space-x-3">
                <input
                  type="date"
                  [(ngModel)]="dateRange.start"
                  (change)="filterRecords()"
                  class="flex-1 bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
                />
                <span class="text-gray-400">a</span>
                <input
                  type="date"
                  [(ngModel)]="dateRange.end"
                  (change)="filterRecords()"
                  class="flex-1 bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Formulario de registro premium -->
        <div
          *ngIf="showrendimientoForm"
          class="bg-gradient-to-br from-gray-900/50 to-gray-800/50 rounded-2xl shadow-lg p-6 border border-gray-700"
        >
          <div class="flex items-center mb-4">
            <mat-icon class="text-sky-400 mr-2">note_add</mat-icon>
            <h4 class="text-lg font-semibold text-sky-400">
              Nuevo Registro de Rendimiento
            </h4>
          </div>

          <form
            [formGroup]="recordForm"
            (ngSubmit)="addRecord()"
            class="space-y-5"
          >
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2"
                  >Métrica</label
                >
                <select
                  formControlName="idmetrica"
                  class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
                >
                  <option value="">Seleccionar métrica</option>
                  <option *ngFor="let metric of metrics" [value]="metric.id">
                    {{ metric.nombre }} ({{ metric.unidad }})
                  </option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2"
                  >Valor</label
                >
                <div class="relative">
                  <input
                    type="number"
                    step="0.01"
                    formControlName="valor"
                    placeholder="Ingrese el valor"
                    class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2.5 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
                  />
                  <mat-icon class="absolute left-3 top-2.5 text-gray-400"
                    >numbers</mat-icon
                  >
                </div>
                                          <div *ngIf="recordForm.get('valor')?.errors">
  <small class="text-red-500">Campo Obligatorio.</small>
</div>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2"
                  >Comentarios</label
                >
                <div class="relative">
                  <input
                    type="text"
                    formControlName="comentarios"
                    placeholder="Opcional"
                    class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2.5 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
                  />
                  <mat-icon class="absolute left-3 top-2.5 text-gray-400"
                    >notes</mat-icon
                  >
                </div>
              </div>
            </div>

            <div class="flex justify-end space-x-3 pt-4">
              <button
                (click)="this.showrendimientoForm = false"
                type="button"
                class="px-4 py-2.5 border border-gray-700 rounded-lg text-sm font-medium text-gray-300 hover:bg-gray-700/50 transition-colors"
              >
                <mat-icon class="mr-1 text-sm">cancel</mat-icon>
                Cancelar
              </button>
              <button
                type="submit"
                [disabled]="recordForm.invalid"
                class="px-4 py-2.5 bg-gradient-to-r from-sky-600 to-sky-500 rounded-lg text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md hover:shadow-sky-500/20"
              >
                <mat-icon class="mr-1 text-sm">save</mat-icon>
                Guardar Registro
              </button>
            </div>
          </form>
        </div>

        <!-- Tabla de registros premium -->
        <div
          class="bg-gradient-to-br from-gray-900/50 to-gray-800/50 rounded-2xl shadow-lg border border-gray-700 overflow-hidden"
        >
          <div
            class="p-5 border-b border-gray-700 flex items-center justify-between"
          >
            <div class="flex items-center text-sky-400">
              <mat-icon class="mr-2">table_view</mat-icon>
              <span class="font-medium">Historial de Registros</span>
            </div>
            <div class="text-xs text-gray-400">
              Mostrando {{ filteredRecords.length }} registros
            </div>
          </div>

          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-700">
              <thead class="bg-gradient-to-r from-sky-900/30 to-cyan-900/20">
                <tr>
                  <th
                    scope="col"
                    class="px-6 py-4 text-left text-xs font-medium text-sky-400 uppercase tracking-wider"
                  >
                    <div class="flex items-center">
                      <mat-icon class="mr-2 text-sm">straighten</mat-icon>
                      Métrica
                    </div>
                  </th>
                  <th
                    scope="col"
                    class="px-6 py-4 text-left text-xs font-medium text-sky-400 uppercase tracking-wider"
                  >
                    <div class="flex items-center">
                      <mat-icon class="mr-2 text-sm">trending_up</mat-icon>
                      Valor
                    </div>
                  </th>
                  <th
                    scope="col"
                    class="px-6 py-4 text-left text-xs font-medium text-sky-400 uppercase tracking-wider"
                  >
                    <div class="flex items-center">
                      <mat-icon class="mr-2 text-sm">calendar_month</mat-icon>
                      Fecha
                    </div>
                  </th>
                  <th
                    scope="col"
                    class="px-6 py-4 text-left text-xs font-medium text-sky-400 uppercase tracking-wider"
                  >
                    <div class="flex items-center">
                      <mat-icon class="mr-2 text-sm">notes</mat-icon>
                      Comentarios
                    </div>
                  </th>
                  <th
                    scope="col"
                    class="px-6 py-4 text-right text-xs font-medium text-sky-400 uppercase tracking-wider"
                  >
                    <div class="flex items-center justify-end">
                      <mat-icon class="mr-2 text-sm">settings</mat-icon>
                      Acciones
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-700">
                <tr
                  *ngFor="let record of filteredRecords"
                  class="hover:bg-gray-800/30 transition-colors"
                >
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                      <div
                        class="flex-shrink-0 h-10 w-10 rounded-full bg-sky-900/20 flex items-center justify-center"
                      >
                        <mat-icon class="text-sky-400">speed</mat-icon>
                      </div>
                      <div class="ml-4">
                        <div class="text-sm font-medium text-gray-100">
                          {{ record?.metrica?.nombre }}
                        </div>
                        <div class="text-xs text-sky-400">
                          {{ record?.metrica?.unidad }}
                        </div>
                      </div>
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-lg font-bold text-emerald-400 font-mono">
                      {{ record?.valor }}
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-100">
                      {{ record.fecha | date : "dd/MM/yyyy" }}
                    </div>
                    <div class="text-xs text-gray-500">
                      {{ record.fecha | date : "HH:mm" }}
                    </div>
                  </td>
                  <td class="px-6 py-4">
                    <div class="text-sm text-gray-400 max-w-xs truncate">
                      {{ record.comentarios || "-" }}
                    </div>
                  </td>
                  <td
                    class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"
                  >
                    <div class="flex justify-end space-x-2">
                      <button
                        (click)="deleteItem('record', record.id)"
                        class="p-2 rounded-lg text-gray-400 hover:text-red-400 hover:bg-gray-700/50 transition-colors"
                        matTooltip="Eliminar registro"
                      >
                        <mat-icon>delete</mat-icon>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="filteredRecords.length === 0">
                  <td colspan="5" class="px-6 py-12 text-center">
                    <div
                      class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-sky-900/20 to-cyan-900/10 mb-4"
                    >
                      <mat-icon class="text-2xl text-sky-400"
                        >data_usage</mat-icon
                      >
                    </div>
                    <h3 class="text-lg font-medium text-gray-200 mb-2">
                      No se encontraron registros
                    </h3>
                    <p class="text-gray-500 max-w-md mx-auto mb-4">
                      Intenta ajustar los filtros o agrega nuevos registros
                    </p>
                    <button
                      (click)="mostrarFormRendimiento()"
                      class="px-4 py-2 bg-gradient-to-r from-sky-600 to-sky-500 rounded-lg text-sm font-medium transition-all shadow-md hover:shadow-sky-500/20 inline-flex items-center"
                    >
                      <mat-icon class="mr-1 text-sm">add</mat-icon>
                      Crear nuevo registro
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Paginación -->
          <div
            class="px-6 py-4 border-t border-gray-700 flex items-center justify-between"
          >
            <div class="text-sm text-gray-400">
              Mostrando {{ filteredRecords.length }} de
              {{ records.length }} registros
            </div>
            <div class="flex space-x-2">
              <button
                class="p-2 rounded-lg text-gray-400 hover:text-sky-400 hover:bg-gray-700/50 transition-colors"
              >
                <mat-icon>chevron_left</mat-icon>
              </button>
              <button class="p-2 rounded-lg bg-sky-900/30 text-sky-400">
                1
              </button>
              <button
                class="p-2 rounded-lg text-gray-400 hover:text-sky-400 hover:bg-gray-700/50 transition-colors"
              >
                2
              </button>
              <button
                class="p-2 rounded-lg text-gray-400 hover:text-sky-400 hover:bg-gray-700/50 transition-colors"
              >
                <mat-icon>chevron_right</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
    <div
      *ngIf="showgoalsForm"
      class="bg-gradient-to-br from-gray-900/50 to-gray-800/50 rounded-2xl shadow-lg p-6 border border-gray-700"
    >
      <div class="flex items-center mb-4">
        <mat-icon class="text-emerald-400 mr-2">flag</mat-icon>
        <h4 class="text-lg font-semibold text-emerald-400">
          Nuevo Objetivo de Rendimiento
        </h4>
      </div>

      <form [formGroup]="goalForm" (ngSubmit)="addGoal()" class="space-y-5">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2"
              >Métrica</label
            >
            <select
              formControlName="idmetrica"
              class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
            >
              <option value="">Seleccionar métrica</option>
              <option *ngFor="let metric of metrics" [value]="metric.id">
                {{ metric.nombre }} ({{ metric.unidad }})
              </option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2"
              >Valor objetivo</label
            >
            <div class="relative">
              <input
                type="number"
                step="0.01"
                formControlName="valorObjetivo"
                placeholder="Valor a alcanzar"
                class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2.5 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
              />
              <mat-icon class="absolute left-3 top-2.5 text-gray-400"
                >trending_up</mat-icon
              >
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2"
              >Fecha objetivo</label
            >
            <div class="relative">
              <input
                type="date"
                formControlName="fechaObjetivo"
                class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2.5 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all"
              />
              <mat-icon class="absolute left-3 top-2.5 text-gray-400"
                >calendar_month</mat-icon
              >
            </div>
          </div>
          <div *ngIf="goalForm.get('fechaObjetivo')?.errors?.['fechaMinima']">
  <small class="text-red-500">La fecha debe ser al menos una semana después de hoy.</small>
</div>
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2"
              >Prioridad (1-5)</label
            >
            <div class="flex items-center space-x-3">
              <input
                type="range"
                min="1"
                max="5"
                step="1"
                formControlName="prioridad"
                class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"
              />
              <span
                class="text-sm font-bold w-10 text-center bg-emerald-900/30 text-emerald-400 rounded-lg py-1.5"
              >
                {{ goalForm.value.prioridad || 1 }}
              </span>
            </div>
            <div class="flex justify-between mt-1 text-xs text-gray-400">
              <span>Baja</span>
              <span>Alta</span>
            </div>
          </div>
        </div>

        <div class="flex justify-end space-x-3 pt-4">
          <button
            type="button"
            (click)="this.showgoalsForm = false"
            class="px-4 py-2.5 border border-gray-700 rounded-lg text-sm font-medium text-gray-300 hover:bg-gray-700/50 transition-colors"
          >
            <mat-icon class="mr-1 text-sm">cancel</mat-icon>
            Cancelar
          </button>
          <button
            type="submit"
            [disabled]="goalForm.invalid"
            class="px-4 py-2.5 bg-gradient-to-r from-emerald-600 to-emerald-500 rounded-lg text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md hover:shadow-emerald-500/20"
          >
            <mat-icon class="mr-1 text-sm">save</mat-icon>
            Guardar Objetivo
          </button>
        </div>
      </form>
    </div>
    <div
      *ngIf="currentView === 'medicion'"
      class="space-y-6"
    >
          <div class="flex justify-between items-center">
      <h3 *ngIf="showgoalsForm == false" class="text-xl font-bold flex items-center text-emerald-400">
        <mat-icon class="mr-2 text-emerald-400">flag</mat-icon>
        Mis Mediciones Fisicas
      </h3>
      <button *ngIf="showgoalsForm == false" 
        (click)="mostrarFormMedicion()"
        class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-emerald-600 to-emerald-500 rounded-lg text-sm font-medium transition-all shadow-md hover:shadow-emerald-500/20"
      >
        <mat-icon  class="mr-2 text-sm">add</mat-icon>
        Nueva Medicion
      </button>
    </div>

      <!-- Vista de Formulario -->
      <div
        *ngIf="showmedicionForm"
        class="bg-gradient-to-br from-gray-900/50 to-gray-800/50 rounded-2xl shadow-xl border border-gray-700 p-6 mb-10"
      >
        <div class="flex items-center mb-6">
          <mat-icon class="text-sky-400 mr-2">monitor_weight</mat-icon>
        </div>

        <form
          [formGroup]="medicionForm"
          (ngSubmit)="addMedicion()"
          class="grid grid-cols-1 md:grid-cols-2 gap-6"
        >
          <!-- Columna 1 -->
          <div class="space-y-5">
            <div>
              <label
                class="block text-sm font-medium text-gray-300 mb-2 flex items-center"
              >
                <mat-icon class="mr-2 text-xs text-amber-400">calendar_month</mat-icon>
                Peso (kg)
              </label>
              <input
                type="number"
                step="0.1"
                formControlName="peso"
                placeholder="Ej: 72.5"
                class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-2.5 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
              />
            </div>
            <div *ngIf="medicionForm.get('peso')?.touched && medicionForm.get('peso')?.invalid">
      <small *ngIf="medicionForm.get('peso')?.errors?.['required']" class="error">El peso es obligatorio.</small>
      <small *ngIf="medicionForm.get('peso')?.errors?.['min']" class="error">Debe ser mayor a 30 kg.</small>
      <small *ngIf="medicionForm.get('peso')?.errors?.['max']" class="error">No debe superar 250 kg.</small>
    </div>

            <div>
              <label
                class="block text-sm font-medium text-gray-300 mb-2 flex items-center"
              >
                <mat-icon class="mr-2 text-xs text-purple-400">height</mat-icon>
                Estatura (cm)
              </label>
              <input
                type="number"
                formControlName="estatura"
                placeholder="Ej: 175"
                class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-2.5 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
              />
            </div>
            <div *ngIf="medicionForm.get('estatura')?.touched && medicionForm.get('estatura')?.invalid">
      <small *ngIf="medicionForm.get('estatura')?.errors?.['required']" class="error">La estatura es obligatoria.</small>
      <small *ngIf="medicionForm.get('estatura')?.errors?.['min']" class="error">Mínimo 120 cm.</small>
      <small *ngIf="medicionForm.get('estatura')?.errors?.['max']" class="error">Máximo 230 cm.</small>
    </div>

            <div>
              <label
                class="block text-sm font-medium text-gray-300 mb-2 flex items-center"
              >
                <mat-icon class="mr-2 text-xs text-red-400">monitor_weight</mat-icon>
                % Grasa Corporal
              </label>
              <input
                type="number"
                step="0.1"
                formControlName="porcentajeGrasa"
                placeholder="Ej: 15.2"
                class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-2.5 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
              />
            </div>
            <div *ngIf="medicionForm.get('porcentajeGrasa')?.touched && medicionForm.get('porcentajeGrasa')?.invalid">
      <small *ngIf="medicionForm.get('porcentajeGrasa')?.errors?.['required']" class="error">Este campo es obligatorio.</small>
      <small *ngIf="medicionForm.get('porcentajeGrasa')?.errors?.['min']" class="error">Debe ser mayor a 0.</small>
      <small *ngIf="medicionForm.get('porcentajeGrasa')?.errors?.['max']" class="error">No puede superar 75%.</small>
    </div>

            <div>
              <label
                class="block text-sm font-medium text-gray-300 mb-2 flex items-center"
              >
                <mat-icon class="mr-2 text-xs text-green-400"
                  >fitness_center</mat-icon
                >
                Masa Muscular (kg)
              </label>
              <input
                type="number"
                step="0.1"
                formControlName="masaMuscular"
                placeholder="Ej: 58.3"
                class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-2.5 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
              />
            </div>
            <div *ngIf="medicionForm.get('masaMuscular')?.touched && medicionForm.get('masaMuscular')?.invalid">
      <small class="error" *ngIf="medicionForm.get('masaMuscular')?.errors?.['required']">Obligatorio.</small>
      <small class="error" *ngIf="medicionForm.get('masaMuscular')?.errors?.['min']">Mínimo 10 kg.</small>
      <small class="error" *ngIf="medicionForm.get('masaMuscular')?.errors?.['max']">Máximo 150 kg.</small>
    </div>
          </div>

          <!-- Columna 2 -->
          <div class="space-y-5">
            <div>
              <label
                class="block text-sm font-medium text-gray-300 mb-2 flex items-center"
              >
                <mat-icon class="mr-2 text-xs text-cyan-400"
                  >straighten</mat-icon
                >
                Circunferencia Brazo (cm)
              </label>
              <input
                type="number"
                step="0.1"
                formControlName="circunferenciaBrazo"
                placeholder="Ej: 32.5"
                class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-2.5 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
              />
            </div>
            <div *ngIf="medicionForm.get('circunferenciaBrazo')?.touched && medicionForm.get('circunferenciaBrazo')?.invalid">
      <small class="error">Debe estar entre 15 y 60 cm.</small>
    </div>

            <div>
              <label
                class="block text-sm font-medium text-gray-300 mb-2 flex items-center"
              >
                <mat-icon class="mr-2 text-xs text-rose-400">compress</mat-icon>
                Circunferencia Cintura (cm)
              </label>
              <input
                type="number"
                step="0.1"
                formControlName="circunferenciaCintura"
                placeholder="Ej: 80.0"
                class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-2.5 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
              />
            </div>
            <div *ngIf="medicionForm.get('circunferenciaCintura')?.touched && medicionForm.get('circunferenciaCintura')?.invalid">
      <small class="error">Debe estar entre 40 y 160 cm.</small>
    </div>

            <div>
              <label
                class="block text-sm font-medium text-gray-300 mb-2 flex items-center"
              >
                <mat-icon class="mr-2 text-xs text-pink-400"
                  >roundabout_left</mat-icon
                >
                Circunferencia Cadera (cm)
              </label>
              <input
                type="number"
                step="0.1"
                formControlName="circunferenciaCadera"
                placeholder="Ej: 95.0"
                class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-2.5 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
              />
            </div>
            <div *ngIf="medicionForm.get('circunferenciaCadera')?.touched && medicionForm.get('circunferenciaCadera')?.invalid">
      <small class="error">Debe estar entre 40 y 160 cm.</small>
    </div>

            <div>
              <label
                class="block text-sm font-medium text-gray-300 mb-2 flex items-center"
              >
                <mat-icon class="mr-2 text-xs text-red-500">favorite</mat-icon>
                Presión Arterial
              </label>
              <input
                type="text"
                formControlName="presionArterial"
                placeholder="Ej: 120/80"
                class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-2.5 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
              />
            </div>
            <div *ngIf="medicionForm.get('presionArterial')?.touched && medicionForm.get('presionArterial')?.invalid">
      <small *ngIf="medicionForm.get('presionArterial')?.errors?.['required']" class="error">Campo obligatorio.</small>
      <small *ngIf="medicionForm.get('presionArterial')?.errors?.['pattern']" class="error">Formato inválido (ej. 120/80).</small>
    </div>

            <div>
              <label
                class="block text-sm font-medium text-gray-300 mb-2 flex items-center"
              >
                <mat-icon class="mr-2 text-xs text-rose-500"
                  >monitor_heart</mat-icon
                >
                Frecuencia Cardíaca (reposo)
              </label>
              <input
                type="number"
                formControlName="frecuenciaCardiacaReposo"
                placeholder="Ej: 65"
                class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-2.5 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
              />
            </div>
          </div>
          <div *ngIf="medicionForm.get('frecuenciaCardiacaReposo')?.touched && medicionForm.get('frecuenciaCardiacaReposo')?.invalid">
      <small class="error">Debe estar entre 30 y 130 lpm.</small>
    </div>

          <!-- Notas -->
          <div class="md:col-span-2">
            <label
              class="block text-sm font-medium text-gray-300 mb-2 flex items-center"
            >
              <mat-icon class="mr-2 text-xs text-gray-400">notes</mat-icon>
              Notas adicionales
            </label>
            <textarea
              formControlName="notas"
              rows="3"
              placeholder="Observaciones sobre esta medición..."
              class="w-full bg-gray-800/50 border border-gray-700 rounded-xl px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
            ></textarea>
          </div>
           <div *ngIf="medicionForm.get('notas')?.touched && medicionForm.get('notas')?.invalid">
      <small class="error">Máximo 500 caracteres.</small>
    </div>

          <!-- Botones -->
          <div class="md:col-span-2 flex justify-end space-x-4 pt-4">
            <button
              type="button"
              
              (click)="showmedicionForm = false"
              class="px-4 py-2.5 border border-gray-700 rounded-xl text-sm font-medium text-gray-300 hover:bg-gray-700/50 transition-colors"
            >
              <mat-icon class="mr-1 text-sm">cancel</mat-icon>
              Cancelar
            </button>
          </div>
          <div class="md:col-span-2 flex justify-end space-x-4 pt-4">
            <button
  type="button"
  [disabled]="medicionForm.invalid"
  (click)="addMedicion()"
  [ngClass]="{
    'bg-green-700 text-white hover:bg-green-800 cursor-pointer': !medicionForm.invalid,
    'bg-gray-400 text-white cursor-not-allowed opacity-50': medicionForm.invalid
  }"
  class="px-4 py-2.5 border border-green-700 rounded-xl text-sm font-medium transition-colors"
>
  Agregar Medición
</button>
          </div>
        </form>
      </div>
      <!-- Listado de mediciones -->
      <div
        class="bg-gradient-to-br from-gray-900/50 to-gray-800/50 rounded-2xl shadow-xl border border-gray-700 overflow-hidden"
      >
        <div
          class="p-5 border-b border-gray-700 flex items-center justify-between"
        >
          <div class="flex items-center text-sky-400">
            <mat-icon class="mr-2">list_alt</mat-icon>
            <span class="font-medium">Historial de Mediciones</span>
          </div>
        </div>

        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-700">
            <thead class="bg-gradient-to-r from-sky-900/30 to-cyan-900/20">
              <tr>
                <th
                  scope="col"
                  class="px-6 py-4 text-left text-xs font-medium text-sky-400 uppercase tracking-wider"
                >
                  Fecha
                </th>
                <th
                  scope="col"
                  class="px-6 py-4 text-left text-xs font-medium text-sky-400 uppercase tracking-wider"
                >
                  Peso (kg)
                </th>
                <th
                  scope="col"
                  class="px-6 py-4 text-left text-xs font-medium text-sky-400 uppercase tracking-wider"
                >
                  IMC
                </th>
                <th
                  scope="col"
                  class="px-6 py-4 text-left text-xs font-medium text-sky-400 uppercase tracking-wider"
                >
                  % Grasa
                </th>
                <th
                  scope="col"
                  class="px-6 py-4 text-left text-xs font-medium text-sky-400 uppercase tracking-wider"
                >
                  Masa Musc. (kg)
                </th>
                <th
                  scope="col"
                  class="px-6 py-4 text-right text-xs font-medium text-sky-400 uppercase tracking-wider"
                >
                  Acciones
                </th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-700">
              <tr
                *ngFor="let med of mediciones"
                class="hover:bg-gray-800/30 transition-colors"
              >
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-100">
                    {{ med.fecha | date : "dd/MM/yyyy" }}
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-bold text-amber-400">
                    {{ med.peso }} kg
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div
                    class="text-sm font-bold"
                    [class.text-emerald-400]="med.imc < 25"
                    [class.text-amber-400]="med.imc >= 25 && med.imc < 30"
                    [class.text-red-400]="med.imc >= 30"
                  >
                    {{ med.imc }}
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-bold text-red-400">
                    {{ med.porcentajeGrasa }}%
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-bold text-green-400">
                    {{ med.masaMuscular }} kg
                  </div>
                </td>
                <td
                  class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"
                >
                  <div class="flex justify-end space-x-2">
                    <button (click)="deleteItem('medicion',med.id)"
                      class="p-2 rounded-lg text-gray-400 hover:text-red-400 hover:bg-gray-700/50 transition-colors"
                      matTooltip="Eliminar medición"
                    >
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="mediciones.length === 0">
                <td colspan="6" class="px-6 py-12 text-center">
                  <div
                    class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-sky-900/20 to-cyan-900/10 mb-4"
                  >
                    <mat-icon class="text-2xl text-sky-400"
                      >data_usage</mat-icon
                    >
                  </div>
                  <h3 class="text-lg font-medium text-gray-200 mb-2">
                    No se encontraron mediciones
                  </h3>
                  <p class="text-gray-500 max-w-md mx-auto mb-4">
                    Comienza registrando tus primeras mediciones físicas
                  </p>
                  <button
                    (click)="(this.showmedicionForm == false)"
                    class="px-4 py-2 bg-gradient-to-r from-sky-600 to-sky-500 rounded-lg text-sm font-medium transition-all shadow-md hover:shadow-sky-500/20 inline-flex items-center"
                  >
                    <mat-icon class="mr-1 text-sm">add</mat-icon>
                    Crear primera medición
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <!-- Vista de Objetivos -->
  <div *ngIf="currentView === 'goals'" class="space-y-6">
    <div class="flex justify-between items-center">
      <h3 *ngIf="showgoalsForm == false" class="text-xl font-bold flex items-center text-emerald-400">
        <mat-icon class="mr-2 text-emerald-400">flag</mat-icon>
        Mis Objetivos de Rendimiento
      </h3>
      <button *ngIf="showgoalsForm == false" 
        (click)="mostrarFormObjetivos()"
        class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-emerald-600 to-emerald-500 rounded-lg text-sm font-medium transition-all shadow-md hover:shadow-emerald-500/20"
      >
        <mat-icon  class="mr-2 text-sm">add</mat-icon>
        Nuevo Objetivo
      </button>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div
        *ngFor="let obj of objetivos"
        class="bg-gradient-to-br from-gray-900/50 to-gray-800/50 rounded-2xl shadow-xl overflow-hidden border border-gray-700 hover:border-emerald-500/30 transition-all hover:-translate-y-1"
      >
        <div class="p-6">
          <div class="flex justify-between items-start">
            <div>
              <h4 class="font-bold text-xl text-gray-100">
                {{ obj.nombreObjetivo }}
              </h4>
              <span
                class="text-xs font-mono px-2 py-1 mt-1 inline-block rounded-full bg-emerald-500/10 text-emerald-400"
              >
                {{ obj.unidad }}
              </span>
            </div>
          </div>

          <div class="mt-6">
            <div class="flex justify-between text-sm mb-3">
              <span class="text-gray-400">Progreso hacia el objetivo</span>
              <span class="font-bold text-emerald-400"
                >{{ obj.porcentajeCompletado }}%</span
              >
            </div>
            <div class="w-full bg-gray-700 rounded-full h-3">
              <div
                class="h-3 rounded-full"
                [class.bg-emerald-500]="obj.porcentajeCompletado < 100"
                [class.bg-green-500]="obj.porcentajeCompletado >= 100"
                [style.width]="obj.porcentajeCompletado + '%'"
              ></div>
            </div>
          </div>

          <div class="mt-6 grid grid-cols-2 gap-4">
            <div class="p-3 bg-gray-800/30 rounded-lg border border-gray-700">
              <p class="text-xs text-gray-400 mb-1">Valor actual</p>
              <p class="text-lg font-bold text-gray-100 font-mono">
                {{ obj.valorActual | number : "1.1-1" }}
              </p>
            </div>
            <div class="p-3 bg-gray-800/30 rounded-lg border border-gray-700">
              <p class="text-xs text-gray-400 mb-1">Objetivo</p>
              <p class="text-lg font-bold text-emerald-400 font-mono">
                {{ obj.valorObjetivo | number : "1.1-1" }}
              </p>
            </div>
            <div class="p-3 bg-gray-800/30 rounded-lg border border-gray-700">
              <p class="text-xs text-gray-400 mb-1">Fecha límite</p>
              <p class="text-sm font-medium text-gray-100 flex items-center">
                <mat-icon class="text-xs mr-1 text-emerald-400"
                  >calendar_month</mat-icon
                >
                {{ obj.fechaObjetivo | date : "dd/MM/yyyy" }}
              </p>
            </div>
            <div class="p-3 bg-gray-800/30 rounded-lg border border-gray-700">
              <p class="text-xs text-gray-400 mb-1">Estado</p>
              <span
                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                [class.bg-green-500]="obj.porcentajeCompletado >= 100"
                [class.text-green-400]="obj.porcentajeCompletado >= 100"
                [class.bg-emerald-500]="obj.porcentajeCompletado < 100"
                [class.text-emerald-400]="obj.porcentajeCompletado < 100"
              >
                {{
                  obj.porcentajeCompletado >= 100 ? "Completado" : "En progreso"
                }}
              </span>
            </div>
          </div>

          <div class="mt-6 flex justify-between items-center">
            <button
              (click)="toggleGoalCompletion(obj)"
              [disabled]="obj.completado || obj.porcentajeCompletado < 100"
              class="px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center"
              [class.bg-green-500]="obj.porcentajeCompletado >= 100"
              [class.text-green-400]="obj.porcentajeCompletado >= 100"
              [class.hover:bg-green-600]="obj.porcentajeCompletado >= 100"
              [class.bg-emerald-900]="obj.porcentajeCompletado < 100"
              [class.text-emerald-400]="obj.porcentajeCompletado < 100"
              [class.hover:bg-emerald-900]="obj.porcentajeCompletado < 100"
            >
              <mat-icon class="mr-1 text-sm">{{
                obj.porcentajeCompletado >= 100 ? "check_circle" : "flag"
              }}</mat-icon>
                {{
                  obj.completado ? 'Completado' :
                  (obj.porcentajeCompletado >= 100 ? 'Marcar como completado' : '')
                }}
            </button>
            <button
              (click)="deleteItem('goal',obj.id)"
              class="p-2 rounded-lg text-gray-400 hover:text-red-400 hover:bg-gray-700/50 transition-colors"
              matTooltip="Eliminar objetivo"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Vista de Estadísticas -->
  <div *ngIf="currentView === 'stats'" class="space-y-6">
    <div class="flex justify-between items-center">
      <h3 class="text-xl font-bold flex items-center text-sky-400">
        <mat-icon class="mr-2 text-sky-400">insights</mat-icon>
        Estadísticas de Rendimiento
      </h3>
    </div>

    <!-- Filtros para gráficos -->
    <div
      class="bg-gradient-to-br from-gray-900/50 to-gray-800/50 rounded-2xl shadow-lg p-6 border border-gray-700"
    >
      <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
        <div>
          <label
            class="block text-sm font-medium text-gray-300 mb-2 flex items-center"
          >
            <mat-icon class="mr-2 text-sm text-sky-400">date_range</mat-icon>
            Rango de tiempo
          </label>
          <div class="flex space-x-2">
            <button
              *ngFor="let rango of rangos"
              class="px-3 py-1 text-xs rounded-lg transition-colors"
              [class.bg-indigo-600]="rangoSeleccionado === rango.value"
              [class.text-white]="rangoSeleccionado === rango.value"
              [class.bg-gray-700]="rangoSeleccionado !== rango.value"
              [class.text-gray-300]="rangoSeleccionado !== rango.value"
              [class.hover:bg-gray-600]="rangoSeleccionado !== rango.value"
              (click)="cambiarRango(rango.value)"
            >
              {{ rango.label }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Gráficos principales -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Gráfico de evolución -->
      <div
        class="bg-gradient-to-br from-gray-900/50 to-gray-800/50 rounded-2xl shadow-xl border border-gray-700 p-6"
      >
        <div class="flex justify-between items-center mb-6">
          <h4 class="text-lg font-semibold text-sky-400 flex items-center">
            <mat-icon class="mr-2 text-sky-400">trending_up</mat-icon>
            Evolución de Rendimiento
          </h4>
          <div class="flex space-x-2">
            <button
              class="p-2 rounded-lg text-gray-400 hover:text-sky-400 hover:bg-gray-700/50 transition-colors"
            >
              <mat-icon>show_chart</mat-icon>
            </button>
            <button
              class="p-2 rounded-lg text-gray-400 hover:text-emerald-400 hover:bg-gray-700/50 transition-colors"
            >
              <mat-icon>bar_chart</mat-icon>
            </button>
          </div>
        </div>
        <div class="h-80">
          <canvas #evolucionChart></canvas>
        </div>
        <div class="mt-4 flex flex-wrap gap-2">
          <div class="flex items-center">
            <div class="w-3 h-3 rounded-full bg-sky-500 mr-2"></div>
            <span class="text-xs text-gray-400">Velocidad (km/h)</span>
          </div>
          <div class="flex items-center">
            <div class="w-3 h-3 rounded-full bg-emerald-500 mr-2"></div>
            <span class="text-xs text-gray-400">Fuerza (kg)</span>
          </div>
          <div class="flex items-center">
            <div class="w-3 h-3 rounded-full bg-purple-500 mr-2"></div>
            <span class="text-xs text-gray-400">Resistencia (min)</span>
          </div>
        </div>
      </div>

      <!-- Gráfico de distribución -->
      <div
        class="bg-gradient-to-br from-gray-900/50 to-gray-800/50 rounded-2xl shadow-xl border border-gray-700 p-6"
      >
        <div class="flex justify-between items-center mb-6">
          <h4 class="text-lg font-semibold text-emerald-400 flex items-center">
            <mat-icon class="mr-2 text-emerald-400">donut_large</mat-icon>
            Distribución de Esfuerzo
          </h4>
          <div class="flex space-x-2">
            <button
              class="p-2 rounded-lg text-gray-400 hover:text-emerald-400 hover:bg-gray-700/50 transition-colors"
            >
              <mat-icon>pie_chart</mat-icon>
            </button>
            <button
              class="p-2 rounded-lg text-gray-400 hover:text-purple-400 hover:bg-gray-700/50 transition-colors"
            >
              <mat-icon>donut_small</mat-icon>
            </button>
          </div>
        </div>
        <div class="h-80">
          <canvas #rutinasChart></canvas>
        </div>
        <div>
          <div class="bg-gray-700/30 rounded-xl p-4 mb-4">
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm text-gray-300">Progreso general</span>
              <span class="text-sm font-mono"
                >{{ datosC.porcentajeCompletadas }}%</span
              >
            </div>
            <div class="w-full bg-gray-600 rounded-full h-2.5">
              <div
                class="h-2.5 rounded-full bg-green-500"
                [style.width]="datosC.porcentajeCompletadas + '%'"
              ></div>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div class="bg-gray-700/30 rounded-xl p-4">
              <p class="text-2xl font-bold text-green-400">
                {{ datosC.completadas }}
              </p>
              <p class="text-xs text-gray-400">Completadas</p>
            </div>
            <div class="bg-gray-700/30 rounded-xl p-4">
              <p class="text-2xl font-bold text-red-400">
                {{ datosC.incompletas }}
              </p>
              <p class="text-xs text-gray-400">Incompletas</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <footer class="mt-12 pt-8 border-t border-gray-800">
      <div class="flex flex-col md:flex-row justify-between items-center text-gray-400 text-sm">
        <div class="mb-4 md:mb-0">
          © 2025 SportAnalytics Pro - Todos los derechos reservados
        </div>
      </div>
    </footer>
  </div>
</div>

<!-- Loading template -->
<ng-template #loadingTemplate>
  <div
    class="min-h-screen bg-gray-900 flex flex-col items-center justify-center"
  >
    <div class="flex flex-col items-center">
      <div class="relative">
        <div
          class="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"
        ></div>
        <div class="absolute inset-0 flex items-center justify-center">
          <svg
            class="w-8 h-8 text-indigo-400 animate-pulse"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 10V3L4 14h7v7l9-11h-7z"
            ></path>
          </svg>
        </div>
      </div>
      <p class="mt-4 text-gray-300">Cargando tu panel de rendimiento...</p>
    </div>
  </div>
</ng-template>
