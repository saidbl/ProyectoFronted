<div class="stats-container">
  <div class="header">
    <h1> Estad铆sticas Organizacionales</h1>
    <button mat-raised-button color="primary" (click)="refreshStats()" [disabled]="loading">
      <mat-icon>refresh</mat-icon>
      Actualizar
    </button>
  </div>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando estad铆sticas...</p>
  </div>

  <div *ngIf="error" class="error-container">
    <mat-icon color="warn">error_outline</mat-icon>
    <p>Error al cargar las estad铆sticas. Intente nuevamente.</p>
    <button mat-raised-button color="warn" (click)="refreshStats()">
      <mat-icon>refresh</mat-icon>
      Reintentar
    </button>
  </div>

  <div *ngIf="!loading && !error" class="stats-content">
    <!-- Eventos por Mes -->
    <mat-card class="chart-card">
      <mat-card-header>
        <div>
          <h2 class="section-title"> Eventos por Mes</h2>
          <p class="section-subtitle">Distribuci贸n mensual de eventos creados</p>
        </div>
      </mat-card-header>
      <mat-card-content>
        <div *ngIf="eventosPorMes.length > 0" echarts [options]="eventsByMonthChart" class="chart"></div>
        <div *ngIf="eventosPorMes.length === 0" class="no-data">
          <mat-icon>info</mat-icon>
          <p>No hay datos disponibles para eventos por mes</p>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Participaci贸n en Eventos -->
    <mat-card class="chart-card">
      <mat-card-header>
        <div>
          <h2 class="section-title"> Participaci贸n en Eventos</h2>
          <p class="section-subtitle">Equipos inscritos vs capacidad m谩xima</p>
        </div>
      </mat-card-header>
      <mat-card-content>
        <div *ngIf="participacionEventos.length > 0" echarts [options]="participationChart" class="chart"></div>
        <div *ngIf="participacionEventos.length === 0" class="no-data">
          <mat-icon>info</mat-icon>
          <p>No hay datos disponibles para participaci贸n en eventos</p>
        </div>

        <!-- Tabla -->
        <div *ngIf="participacionEventos.length > 0" class="stats-table">
          <table mat-table [dataSource]="participacionEventos" class="custom-table mat-elevation-z2">
            <ng-container matColumnDef="nombre">
              <th mat-header-cell *matHeaderCellDef>Evento</th>
              <td mat-cell *matCellDef="let item">{{item[0]}}</td>
            </ng-container>

            <ng-container matColumnDef="inscritos">
              <th mat-header-cell *matHeaderCellDef>Inscritos</th>
              <td mat-cell *matCellDef="let item">{{item[1]}}</td>
            </ng-container>

            <ng-container matColumnDef="max">
              <th mat-header-cell *matHeaderCellDef>Capacidad</th>
              <td mat-cell *matCellDef="let item">{{item[2]}}</td>
            </ng-container>

            <ng-container matColumnDef="porcentaje">
              <th mat-header-cell *matHeaderCellDef>Ocupaci贸n</th>
              <td mat-cell *matCellDef="let item">
                <div class="progress-container">
                  <strong>{{calculatePercentage(item[1], item[2]) | number:'1.0-1'}}%</strong>
                  <mat-progress-bar 
                    mode="determinate" 
                    [value]="calculatePercentage(item[1], item[2])"
                    [color]="calculatePercentage(item[1], item[2]) > 90 ? 'warn' : 
                            (calculatePercentage(item[1], item[2]) > 70 ? 'accent' : 'primary')">
                  </mat-progress-bar>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['nombre', 'inscritos', 'max', 'porcentaje']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['nombre', 'inscritos', 'max', 'porcentaje'];"></tr>
          </table>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
